import { isPlatformBrowser } from '@angular/common';
import { Inject, Injectable, InjectionToken, Optional, PLATFORM_ID, } from '@angular/core';
// eslint-disable-next-line import/named
import { marked, Renderer } from 'marked';
import { Subject } from 'rxjs';
import { map } from 'rxjs/operators';
import { ClipboardButtonComponent } from './clipboard-button.component';
import { CLIPBOARD_OPTIONS } from './clipboard-options';
import { MARKED_EXTENSIONS } from './marked-extensions';
import { MARKED_OPTIONS } from './marked-options';
import { MarkedRenderer } from './marked-renderer';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@angular/platform-browser";
/* eslint-disable max-len */
export const errorJoyPixelsNotLoaded = '[ngx-markdown] When using the `emoji` attribute you *have to* include Emoji-Toolkit files to `angular.json` or use imports. See README for more information';
export const errorKatexNotLoaded = '[ngx-markdown] When using the `katex` attribute you *have to* include KaTeX files to `angular.json` or use imports. See README for more information';
export const errorMermaidNotLoaded = '[ngx-markdown] When using the `mermaid` attribute you *have to* include Mermaid files to `angular.json` or use imports. See README for more information';
export const errorClipboardNotLoaded = '[ngx-markdown] When using the `clipboard` attribute you *have to* include Clipboard files to `angular.json` or use imports. See README for more information';
export const errorClipboardViewContainerRequired = '[ngx-markdown] When using the `clipboard` attribute you *have to* provide the `viewContainerRef` parameter to `MarkdownService.render()` function';
export const errorSrcWithoutHttpClient = '[ngx-markdown] When using the `src` attribute you *have to* pass the `HttpClient` as a parameter of the `forRoot` method. See README for more information';
/* eslint-enable max-len */
export const SECURITY_CONTEXT = new InjectionToken('SECURITY_CONTEXT');
export class ExtendedRenderer extends Renderer {
    constructor() {
        super(...arguments);
        this.ɵNgxMarkdownRendererExtendedForExtensions = false;
        this.ɵNgxMarkdownRendererExtendedForMermaid = false;
    }
}
export class MarkdownService {
    get options() { return this._options; }
    set options(value) {
        this._options = { ...this.DEFAULT_MARKED_OPTIONS, ...value };
    }
    get renderer() { return this.options.renderer; }
    set renderer(value) {
        this.options.renderer = value;
    }
    constructor(clipboardOptions, extensions, options, platform, securityContext, http, sanitizer) {
        this.clipboardOptions = clipboardOptions;
        this.extensions = extensions;
        this.platform = platform;
        this.securityContext = securityContext;
        this.http = http;
        this.sanitizer = sanitizer;
        this.DEFAULT_MARKED_OPTIONS = {
            renderer: new MarkedRenderer(),
        };
        this.DEFAULT_KATEX_OPTIONS = {
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\begin{equation}', right: '\\end{equation}', display: true },
                { left: '\\begin{align}', right: '\\end{align}', display: true },
                { left: '\\begin{alignat}', right: '\\end{alignat}', display: true },
                { left: '\\begin{gather}', right: '\\end{gather}', display: true },
                { left: '\\begin{CD}', right: '\\end{CD}', display: true },
                { left: '\\[', right: '\\]', display: true },
            ],
        };
        this.DEFAULT_MERMAID_OPTIONS = {
            startOnLoad: false,
        };
        this.DEFAULT_CLIPBOARD_OPTIONS = {
            buttonComponent: undefined,
        };
        this.DEFAULT_PARSE_OPTIONS = {
            decodeHtml: false,
            inline: false,
            emoji: false,
            mermaid: false,
            markedOptions: undefined,
            disableSanitizer: false,
        };
        this.DEFAULT_RENDER_OPTIONS = {
            clipboard: false,
            clipboardOptions: undefined,
            katex: false,
            katexOptions: undefined,
            mermaid: false,
            mermaidOptions: undefined,
        };
        this._reload$ = new Subject();
        this.reload$ = this._reload$.asObservable();
        this.options = options;
    }
    parse(markdown, parseOptions = this.DEFAULT_PARSE_OPTIONS) {
        const { decodeHtml, inline, emoji, mermaid, disableSanitizer, } = parseOptions;
        const markedOptions = {
            ...this.options,
            ...parseOptions.markedOptions,
        };
        const renderer = markedOptions.renderer || this.renderer || new Renderer();
        if (this.extensions) {
            this.renderer = this.extendsRendererForExtensions(renderer);
        }
        if (mermaid) {
            this.renderer = this.extendsRendererForMermaid(renderer);
        }
        const trimmed = this.trimIndentation(markdown);
        const decoded = decodeHtml ? this.decodeHtml(trimmed) : trimmed;
        const emojified = emoji ? this.parseEmoji(decoded) : decoded;
        const marked = this.parseMarked(emojified, markedOptions, inline);
        const sanitized = disableSanitizer ? marked : this.sanitizer.sanitize(this.securityContext, marked);
        return sanitized || '';
    }
    render(element, options = this.DEFAULT_RENDER_OPTIONS, viewContainerRef) {
        const { clipboard, clipboardOptions, katex, katexOptions, mermaid, mermaidOptions, } = options;
        if (katex) {
            this.renderKatex(element, {
                ...this.DEFAULT_KATEX_OPTIONS,
                ...katexOptions,
            });
        }
        if (mermaid) {
            this.renderMermaid(element, {
                ...this.DEFAULT_MERMAID_OPTIONS,
                ...mermaidOptions,
            });
        }
        if (clipboard) {
            this.renderClipboard(element, viewContainerRef, {
                ...this.DEFAULT_CLIPBOARD_OPTIONS,
                ...this.clipboardOptions,
                ...clipboardOptions,
            });
        }
        this.highlight(element);
    }
    reload() {
        this._reload$.next();
    }
    getSource(src) {
        if (!this.http) {
            throw new Error(errorSrcWithoutHttpClient);
        }
        return this.http
            .get(src, { responseType: 'text' })
            .pipe(map(markdown => this.handleExtension(src, markdown)));
    }
    highlight(element) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof Prism === 'undefined' || typeof Prism.highlightAllUnder === 'undefined') {
            return;
        }
        if (!element) {
            element = document;
        }
        const noLanguageElements = element.querySelectorAll('pre code:not([class*="language-"])');
        Array.prototype.forEach.call(noLanguageElements, (x) => x.classList.add('language-none'));
        Prism.highlightAllUnder(element);
    }
    decodeHtml(html) {
        if (!isPlatformBrowser(this.platform)) {
            return html;
        }
        const textarea = document.createElement('textarea');
        textarea.innerHTML = html;
        return textarea.value;
    }
    extendsRendererForExtensions(renderer) {
        const extendedRenderer = renderer;
        if (extendedRenderer.ɵNgxMarkdownRendererExtendedForExtensions === true) {
            return renderer;
        }
        if (this.extensions?.length > 0) {
            marked.use(...this.extensions);
        }
        extendedRenderer.ɵNgxMarkdownRendererExtendedForExtensions = true;
        return renderer;
    }
    extendsRendererForMermaid(renderer) {
        const extendedRenderer = renderer;
        if (extendedRenderer.ɵNgxMarkdownRendererExtendedForMermaid === true) {
            return renderer;
        }
        // eslint-disable-next-line @typescript-eslint/unbound-method
        const defaultCode = renderer.code;
        renderer.code = function (code, language, isEscaped) {
            return language === 'mermaid'
                ? `<div class="mermaid">${code}</div>`
                : defaultCode.call(this, code, language, isEscaped);
        };
        extendedRenderer.ɵNgxMarkdownRendererExtendedForMermaid = true;
        return renderer;
    }
    handleExtension(src, markdown) {
        const urlProtocolIndex = src.lastIndexOf('://');
        const urlWithoutProtocol = urlProtocolIndex > -1
            ? src.substring(urlProtocolIndex + 4)
            : src;
        const lastSlashIndex = urlWithoutProtocol.lastIndexOf('/');
        const lastUrlSegment = lastSlashIndex > -1
            ? urlWithoutProtocol.substring(lastSlashIndex + 1).split('?')[0]
            : '';
        const lastDotIndex = lastUrlSegment.lastIndexOf('.');
        const extension = lastDotIndex > -1
            ? lastUrlSegment.substring(lastDotIndex + 1)
            : '';
        return !!extension && extension !== 'md'
            ? '```' + extension + '\n' + markdown + '\n```'
            : markdown;
    }
    parseMarked(html, markedOptions, inline = false) {
        if (markedOptions.renderer) {
            // clone renderer and remove extended flags otherwise
            // marked throws an error thinking it is a renderer prop
            const renderer = { ...markedOptions.renderer };
            delete renderer.ɵNgxMarkdownRendererExtendedForExtensions;
            delete renderer.ɵNgxMarkdownRendererExtendedForMermaid;
            // remove renderer from markedOptions because if renderer is
            // passed to marked.parse method, it will ignore all extensions
            delete markedOptions.renderer;
            marked.use({ renderer });
        }
        return inline
            ? marked.parseInline(html, markedOptions)
            : marked.parse(html, markedOptions);
    }
    parseEmoji(html) {
        if (!isPlatformBrowser(this.platform)) {
            return html;
        }
        if (typeof joypixels === 'undefined' || typeof joypixels.shortnameToUnicode === 'undefined') {
            throw new Error(errorJoyPixelsNotLoaded);
        }
        return joypixels.shortnameToUnicode(html);
    }
    renderKatex(element, options) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof katex === 'undefined' || typeof renderMathInElement === 'undefined') {
            throw new Error(errorKatexNotLoaded);
        }
        renderMathInElement(element, options);
    }
    renderClipboard(element, viewContainerRef, options) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof ClipboardJS === 'undefined') {
            throw new Error(errorClipboardNotLoaded);
        }
        if (!viewContainerRef) {
            throw new Error(errorClipboardViewContainerRequired);
        }
        const { buttonComponent, buttonTemplate, } = options;
        // target every <pre> elements
        const preElements = element.querySelectorAll('pre');
        for (let i = 0; i < preElements.length; i++) {
            const preElement = preElements.item(i);
            // create <pre> wrapper element
            const preWrapperElement = document.createElement('div');
            preWrapperElement.style.position = 'relative';
            preElement.parentNode.insertBefore(preWrapperElement, preElement);
            preWrapperElement.appendChild(preElement);
            // create toolbar element
            const toolbarWrapperElement = document.createElement('div');
            toolbarWrapperElement.style.position = 'absolute';
            toolbarWrapperElement.style.top = '.5em';
            toolbarWrapperElement.style.right = '.5em';
            toolbarWrapperElement.style.opacity = '0';
            toolbarWrapperElement.style.transition = 'opacity 250ms ease-out';
            toolbarWrapperElement.style.zIndex = '1';
            preWrapperElement.insertAdjacentElement('beforeend', toolbarWrapperElement);
            // register listener to show/hide toolbar
            preElement.onmouseover = () => toolbarWrapperElement.style.opacity = '1';
            preElement.onmouseout = () => toolbarWrapperElement.style.opacity = '0';
            // declare embeddedViewRef holding variable
            let embeddedViewRef;
            // use provided component via input property
            // or provided via ClipboardOptions provider
            if (buttonComponent) {
                const componentRef = viewContainerRef.createComponent(buttonComponent);
                embeddedViewRef = componentRef.hostView;
                componentRef.changeDetectorRef.markForCheck();
            }
            // use provided template via input property
            else if (buttonTemplate) {
                embeddedViewRef = viewContainerRef.createEmbeddedView(buttonTemplate);
            }
            // use default component
            else {
                const componentRef = viewContainerRef.createComponent(ClipboardButtonComponent);
                embeddedViewRef = componentRef.hostView;
                componentRef.changeDetectorRef.markForCheck();
            }
            // declare clipboard instance variable
            let clipboardInstance;
            // attach clipboard.js to root node
            embeddedViewRef.rootNodes.forEach((node) => {
                node.onmouseover = () => toolbarWrapperElement.style.opacity = '1';
                toolbarWrapperElement.appendChild(node);
                clipboardInstance = new ClipboardJS(node, { text: () => preElement.innerText });
            });
            // destroy clipboard instance when view is destroyed
            embeddedViewRef.onDestroy(() => clipboardInstance.destroy());
        }
    }
    renderMermaid(element, options = this.DEFAULT_MERMAID_OPTIONS) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof mermaid === 'undefined' || typeof mermaid.initialize === 'undefined') {
            throw new Error(errorMermaidNotLoaded);
        }
        const mermaidElements = element.querySelectorAll('.mermaid');
        if (mermaidElements.length === 0) {
            return;
        }
        mermaid.initialize(options);
        mermaid.run({ nodes: mermaidElements });
    }
    trimIndentation(markdown) {
        if (!markdown) {
            return '';
        }
        let indentStart;
        return markdown
            .split('\n')
            .map(line => {
            let lineIdentStart = indentStart;
            if (line.length > 0) {
                lineIdentStart = isNaN(lineIdentStart)
                    ? line.search(/\S|$/)
                    : Math.min(line.search(/\S|$/), lineIdentStart);
            }
            if (isNaN(indentStart)) {
                indentStart = lineIdentStart;
            }
            return lineIdentStart
                ? line.substring(lineIdentStart)
                : line;
        }).join('\n');
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.0.0", ngImport: i0, type: MarkdownService, deps: [{ token: CLIPBOARD_OPTIONS, optional: true }, { token: MARKED_EXTENSIONS, optional: true }, { token: MARKED_OPTIONS, optional: true }, { token: PLATFORM_ID }, { token: SECURITY_CONTEXT }, { token: i1.HttpClient, optional: true }, { token: i2.DomSanitizer }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.0.0", ngImport: i0, type: MarkdownService }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.0.0", ngImport: i0, type: MarkdownService, decorators: [{
            type: Injectable
        }], ctorParameters: () => [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [CLIPBOARD_OPTIONS]
                }, {
                    type: Optional
                }] }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [MARKED_EXTENSIONS]
                }, {
                    type: Optional
                }] }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [MARKED_OPTIONS]
                }, {
                    type: Optional
                }] }, { type: Object, decorators: [{
                    type: Inject,
                    args: [PLATFORM_ID]
                }] }, { type: i0.SecurityContext, decorators: [{
                    type: Inject,
                    args: [SECURITY_CONTEXT]
                }] }, { type: i1.HttpClient, decorators: [{
                    type: Optional
                }] }, { type: i2.DomSanitizer }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFya2Rvd24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2xpYi9zcmMvbWFya2Rvd24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUVwRCxPQUFPLEVBRUwsTUFBTSxFQUNOLFVBQVUsRUFDVixjQUFjLEVBQ2QsUUFBUSxFQUNSLFdBQVcsR0FHWixNQUFNLGVBQWUsQ0FBQztBQUV2Qix3Q0FBd0M7QUFDeEMsT0FBTyxFQUFFLE1BQU0sRUFBbUIsUUFBUSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQzNELE9BQU8sRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ3hFLE9BQU8sRUFBRSxpQkFBaUIsRUFBNEMsTUFBTSxxQkFBcUIsQ0FBQztBQUVsRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsY0FBYyxFQUFpQixNQUFNLGtCQUFrQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQzs7OztBQWdDbkQsNEJBQTRCO0FBQzVCLE1BQU0sQ0FBQyxNQUFNLHVCQUF1QixHQUFHLDZKQUE2SixDQUFDO0FBQ3JNLE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixHQUFHLHFKQUFxSixDQUFDO0FBQ3pMLE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUFHLHlKQUF5SixDQUFDO0FBQy9MLE1BQU0sQ0FBQyxNQUFNLHVCQUF1QixHQUFHLDZKQUE2SixDQUFDO0FBQ3JNLE1BQU0sQ0FBQyxNQUFNLG1DQUFtQyxHQUFHLG1KQUFtSixDQUFDO0FBQ3ZNLE1BQU0sQ0FBQyxNQUFNLHlCQUF5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QUNkLFdBQVcsYUFDWCxnQkFBZ0I7a0hBbEVmLGVBQWU7OzJGQUFmLGVBQWU7a0JBRDNCLFVBQVU7OzBCQStETixNQUFNOzJCQUFDLGlCQUFpQjs7MEJBQUcsUUFBUTs7MEJBQ25DLE1BQU07MkJBQUMsaUJBQWlCOzswQkFBRyxRQUFROzswQkFDbkMsTUFBTTsyQkFBQyxjQUFjOzswQkFBRyxRQUFROzswQkFDaEMsTUFBTTsyQkFBQyxXQUFXOzswQkFDbEIsTUFBTTsyQkFBQyxnQkFBZ0I7OzBCQUN2QixRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQge1xyXG4gIEVtYmVkZGVkVmlld1JlZixcclxuICBJbmplY3QsXHJcbiAgSW5qZWN0YWJsZSxcclxuICBJbmplY3Rpb25Ub2tlbixcclxuICBPcHRpb25hbCxcclxuICBQTEFURk9STV9JRCxcclxuICBTZWN1cml0eUNvbnRleHQsXHJcbiAgVmlld0NvbnRhaW5lclJlZixcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvbmFtZWRcclxuaW1wb3J0IHsgbWFya2VkLCBNYXJrZWRFeHRlbnNpb24sIFJlbmRlcmVyIH0gZnJvbSAnbWFya2VkJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IENsaXBib2FyZEJ1dHRvbkNvbXBvbmVudCB9IGZyb20gJy4vY2xpcGJvYXJkLWJ1dHRvbi5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBDTElQQk9BUkRfT1BUSU9OUywgQ2xpcGJvYXJkT3B0aW9ucywgQ2xpcGJvYXJkUmVuZGVyT3B0aW9ucyB9IGZyb20gJy4vY2xpcGJvYXJkLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBLYXRleE9wdGlvbnMgfSBmcm9tICcuL2thdGV4LW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBNQVJLRURfRVhURU5TSU9OUyB9IGZyb20gJy4vbWFya2VkLWV4dGVuc2lvbnMnO1xyXG5pbXBvcnQgeyBNQVJLRURfT1BUSU9OUywgTWFya2VkT3B0aW9ucyB9IGZyb20gJy4vbWFya2VkLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBNYXJrZWRSZW5kZXJlciB9IGZyb20gJy4vbWFya2VkLXJlbmRlcmVyJztcclxuaW1wb3J0IHsgTWVybWFpZEFQSSB9IGZyb20gJy4vbWVybWFpZC1vcHRpb25zJztcclxuXHJcbi8vIGNsaXBib2FyZFxyXG5kZWNsYXJlIGxldCBDbGlwYm9hcmRKUzoge1xyXG4gIG5ldyhcclxuICAgIHNlbGVjdG9yOiBzdHJpbmcgfCBFbGVtZW50IHwgTm9kZUxpc3RPZjxFbGVtZW50PixcclxuICAgIG9wdGlvbnM/OiB7IHRleHQ/OiAoZWxlbTogRWxlbWVudCkgPT4gc3RyaW5nIH0sXHJcbiAgKTogdHlwZW9mIENsaXBib2FyZEpTO1xyXG4gIGRlc3Ryb3koKTogdm9pZDtcclxufTtcclxuXHJcbi8vIGVtb2ppXHJcbmRlY2xhcmUgbGV0IGpveXBpeGVsczoge1xyXG4gIHNob3J0bmFtZVRvVW5pY29kZShpbnB1dDogc3RyaW5nKTogc3RyaW5nO1xyXG59O1xyXG5cclxuLy8ga2F0ZXhcclxuZGVjbGFyZSBsZXQga2F0ZXg6IHVua25vd247XHJcbmRlY2xhcmUgZnVuY3Rpb24gcmVuZGVyTWF0aEluRWxlbWVudChlbGVtOiBIVE1MRWxlbWVudCwgb3B0aW9ucz86IEthdGV4T3B0aW9ucyk6IHZvaWQ7XHJcblxyXG4vLyBtZXJtYWlkXHJcbmRlY2xhcmUgbGV0IG1lcm1haWQ6IHtcclxuICBpbml0aWFsaXplOiAob3B0aW9uczogTWVybWFpZEFQSS5Db25maWcpID0+IHZvaWQ7XHJcbiAgcnVuOiAocnVuT3B0aW9uczogTWVybWFpZEFQSS5SdW5PcHRpb25zKSA9PiB2b2lkO1xyXG59O1xyXG5cclxuLy8gcHJpc21cclxuZGVjbGFyZSBsZXQgUHJpc206IHtcclxuICBoaWdobGlnaHRBbGxVbmRlcjogKGVsZW1lbnQ6IEVsZW1lbnQgfCBEb2N1bWVudCkgPT4gdm9pZDtcclxufTtcclxuXHJcbi8qIGVzbGludC1kaXNhYmxlIG1heC1sZW4gKi9cclxuZXhwb3J0IGNvbnN0IGVycm9ySm95UGl4ZWxzTm90TG9hZGVkID0gJ1tuZ3gtbWFya2Rvd25dIFdoZW4gdXNpbmcgdGhlIGBlbW9qaWAgYXR0cmlidXRlIHlvdSAqaGF2ZSB0byogaW5jbHVkZSBFbW9qaS1Ub29sa2l0IGZpbGVzIHRvIGBhbmd1bGFyLmpzb25gIG9yIHVzZSBpbXBvcnRzLiBTZWUgUkVBRE1FIGZvciBtb3JlIGluZm9ybWF0aW9uJztcclxuZXhwb3J0IGNvbnN0IGVycm9yS2F0ZXhOb3RMb2FkZWQgPSAnW25neC1tYXJrZG93bl0gV2hlbiB1c2luZyB0aGUgYGthdGV4YCBhdHRyaWJ1dGUgeW91ICpoYXZlIHRvKiBpbmNsdWRlIEthVGVYIGZpbGVzIHRvIGBhbmd1bGFyLmpzb25gIG9yIHVzZSBpbXBvcnRzLiBTZWUgUkVBRE1FIGZvciBtb3JlIGluZm9ybWF0aW9uJztcclxuZXhwb3J0IGNvbnN0IGVycm9yTWVybWFpZE5vdExvYWRlZCA9ICdbbmd4LW1hcmtkb3duXSBXaGVuIHVzaW5nIHRoZSBgbWVybWFpZGAgYXR0cmlidXRlIHlvdSAqaGF2ZSB0byogaW5jbHVkZSBNZXJtYWlkIGZpbGVzIHRvIGBhbmd1bGFyLmpzb25gIG9yIHVzZSBpbXBvcnRzLiBTZWUgUkVBRE1FIGZvciBtb3JlIGluZm9ybWF0aW9uJztcclxuZXhwb3J0IGNvbnN0IGVycm9yQ2xpcGJvYXJkTm90TG9hZGVkID0gJ1tuZ3gtbWFya2Rvd25dIFdoZW4gdXNpbmcgdGhlIGBjbGlwYm9hcmRgIGF0dHJpYnV0ZSB5b3UgKmhhdmUgdG8qIGluY2x1ZGUgQ2xpcGJvYXJkIGZpbGVzIHRvIGBhbmd1bGFyLmpzb25gIG9yIHVzZSBpbXBvcnRzLiBTZWUgUkVBRE1FIGZvciBtb3JlIGluZm9ybWF0aW9uJztcclxuZXhwb3J0IGNvbnN0IGVycm9yQ2xpcGJvYXJkVmlld0NvbnRhaW5lclJlcXVpcmVkID0gJ1tuZ3gtbWFya2Rvd25dIFdoZW4gdXNpbmcgdGhlIGBjbGlwYm9hcmRgIGF0dHJpYnV0ZSB5b3UgKmhhdmUgdG8qIHByb3ZpZGUgdGhlIGB2aWV3Q29udGFpbmVyUmVmYCBwYXJhbWV0ZXIgdG8gYE1hcmtkb3duU2VydmljZS5yZW5kZXIoKWAgZnVuY3Rpb24nO1xyXG5leHBvcnQgY29uc3QgZXJyb3JTcmNXaXRob3V0SHR0cENsaWVudCA9ICdbbmd4LW1hcmtkb3duXSBXaGVuIHVzaW5nIHRoZSBgc3JjYCBhdHRyaWJ1dGUgeW91ICpoYXZlIHRvKiBwYXNzIHRoZSBgSHR0cENsaWVudGAgYXMgYSBwYXJhbWV0ZXIgb2YgdGhlIGBmb3JSb290YCBtZXRob2QuIFNlZSBSRUFETUUgZm9yIG1vcmUgaW5mb3JtYXRpb24nO1xyXG4vKiBlc2xpbnQtZW5hYmxlIG1heC1sZW4gKi9cclxuXHJcbmV4cG9ydCBjb25zdCBTRUNVUklUWV9DT05URVhUID0gbmV3IEluamVjdGlvblRva2VuPFNlY3VyaXR5Q29udGV4dD4oJ1NFQ1VSSVRZX0NPTlRFWFQnKTtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUGFyc2VPcHRpb25zIHtcclxuICBkZWNvZGVIdG1sPzogYm9vbGVhbjtcclxuICBpbmxpbmU/OiBib29sZWFuO1xyXG4gIGVtb2ppPzogYm9vbGVhbjtcclxuICBtZXJtYWlkPzogYm9vbGVhbjtcclxuICBtYXJrZWRPcHRpb25zPzogTWFya2VkT3B0aW9ucztcclxuICBkaXNhYmxlU2FuaXRpemVyPzogYm9vbGVhbjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBSZW5kZXJPcHRpb25zIHtcclxuICBjbGlwYm9hcmQ/OiBib29sZWFuO1xyXG4gIGNsaXBib2FyZE9wdGlvbnM/OiBDbGlwYm9hcmRSZW5kZXJPcHRpb25zO1xyXG4gIGthdGV4PzogYm9vbGVhbjtcclxuICBrYXRleE9wdGlvbnM/OiBLYXRleE9wdGlvbnM7XHJcbiAgbWVybWFpZD86IGJvb2xlYW47XHJcbiAgbWVybWFpZE9wdGlvbnM/OiBNZXJtYWlkQVBJLkNvbmZpZztcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEV4dGVuZGVkUmVuZGVyZXIgZXh0ZW5kcyBSZW5kZXJlciB7XHJcbiAgybVOZ3hNYXJrZG93blJlbmRlcmVyRXh0ZW5kZWRGb3JFeHRlbnNpb25zID0gZmFsc2U7XHJcbiAgybVOZ3hNYXJrZG93blJlbmRlcmVyRXh0ZW5kZWRGb3JNZXJtYWlkID0gZmFsc2U7XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIE1hcmtkb3duU2VydmljZSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgREVGQVVMVF9NQVJLRURfT1BUSU9OUzogTWFya2VkT3B0aW9ucyA9IHtcclxuICAgIHJlbmRlcmVyOiBuZXcgTWFya2VkUmVuZGVyZXIoKSxcclxuICB9O1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfS0FURVhfT1BUSU9OUzogS2F0ZXhPcHRpb25zID0ge1xyXG4gICAgZGVsaW1pdGVyczogW1xyXG4gICAgICB7IGxlZnQ6ICckJCcsIHJpZ2h0OiAnJCQnLCBkaXNwbGF5OiB0cnVlIH0sXHJcbiAgICAgIHsgbGVmdDogJyQnLCByaWdodDogJyQnLCBkaXNwbGF5OiBmYWxzZSB9LFxyXG4gICAgICB7IGxlZnQ6ICdcXFxcKCcsIHJpZ2h0OiAnXFxcXCknLCBkaXNwbGF5OiBmYWxzZSB9LFxyXG4gICAgICB7IGxlZnQ6ICdcXFxcYmVnaW57ZXF1YXRpb259JywgcmlnaHQ6ICdcXFxcZW5ke2VxdWF0aW9ufScsIGRpc3BsYXk6IHRydWUgfSxcclxuICAgICAgeyBsZWZ0OiAnXFxcXGJlZ2lue2FsaWdufScsIHJpZ2h0OiAnXFxcXGVuZHthbGlnbn0nLCBkaXNwbGF5OiB0cnVlIH0sXHJcbiAgICAgIHsgbGVmdDogJ1xcXFxiZWdpbnthbGlnbmF0fScsIHJpZ2h0OiAnXFxcXGVuZHthbGlnbmF0fScsIGRpc3BsYXk6IHRydWUgfSxcclxuICAgICAgeyBsZWZ0OiAnXFxcXGJlZ2lue2dhdGhlcn0nLCByaWdodDogJ1xcXFxlbmR7Z2F0aGVyfScsIGRpc3BsYXk6IHRydWUgfSxcclxuICAgICAgeyBsZWZ0OiAnXFxcXGJlZ2lue0NEfScsIHJpZ2h0OiAnXFxcXGVuZHtDRH0nLCBkaXNwbGF5OiB0cnVlIH0sXHJcbiAgICAgIHsgbGVmdDogJ1xcXFxbJywgcmlnaHQ6ICdcXFxcXScsIGRpc3BsYXk6IHRydWUgfSxcclxuICAgIF0sXHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBERUZBVUxUX01FUk1BSURfT1BUSU9OUzogTWVybWFpZEFQSS5Db25maWcgPSB7XHJcbiAgICBzdGFydE9uTG9hZDogZmFsc2UsXHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBERUZBVUxUX0NMSVBCT0FSRF9PUFRJT05TOiBDbGlwYm9hcmRPcHRpb25zID0ge1xyXG4gICAgYnV0dG9uQ29tcG9uZW50OiB1bmRlZmluZWQsXHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBERUZBVUxUX1BBUlNFX09QVElPTlM6IFBhcnNlT3B0aW9ucyA9IHtcclxuICAgIGRlY29kZUh0bWw6IGZhbHNlLFxyXG4gICAgaW5saW5lOiBmYWxzZSxcclxuICAgIGVtb2ppOiBmYWxzZSxcclxuICAgIG1lcm1haWQ6IGZhbHNlLFxyXG4gICAgbWFya2VkT3B0aW9uczogdW5kZWZpbmVkLFxyXG4gICAgZGlzYWJsZVNhbml0aXplcjogZmFsc2UsXHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBERUZBVUxUX1JFTkRFUl9PUFRJT05TOiBSZW5kZXJPcHRpb25zID0ge1xyXG4gICAgY2xpcGJvYXJkOiBmYWxzZSxcclxuICAgIGNsaXBib2FyZE9wdGlvbnM6IHVuZGVmaW5lZCxcclxuICAgIGthdGV4OiBmYWxzZSxcclxuICAgIGthdGV4T3B0aW9uczogdW5kZWZpbmVkLFxyXG4gICAgbWVybWFpZDogZmFsc2UsXHJcbiAgICBtZXJtYWlkT3B0aW9uczogdW5kZWZpbmVkLFxyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgX29wdGlvbnM6IE1hcmtlZE9wdGlvbnMgfCB1bmRlZmluZWQ7XHJcblxyXG4gIGdldCBvcHRpb25zKCk6IE1hcmtlZE9wdGlvbnMgeyByZXR1cm4gdGhpcy5fb3B0aW9ucyE7IH1cclxuICBzZXQgb3B0aW9ucyh2YWx1ZTogTWFya2VkT3B0aW9ucyB8IHVuZGVmaW5lZCkge1xyXG4gICAgdGhpcy5fb3B0aW9ucyA9IHsgLi4udGhpcy5ERUZBVUxUX01BUktFRF9PUFRJT05TLCAuLi52YWx1ZSB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IHJlbmRlcmVyKCk6IE1hcmtlZFJlbmRlcmVyIHsgcmV0dXJuIHRoaXMub3B0aW9ucy5yZW5kZXJlciE7IH1cclxuICBzZXQgcmVuZGVyZXIodmFsdWU6IE1hcmtlZFJlbmRlcmVyKSB7XHJcbiAgICB0aGlzLm9wdGlvbnMucmVuZGVyZXIgPSB2YWx1ZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgX3JlbG9hZCQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG4gIHJlYWRvbmx5IHJlbG9hZCQgPSB0aGlzLl9yZWxvYWQkLmFzT2JzZXJ2YWJsZSgpO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIEBJbmplY3QoQ0xJUEJPQVJEX09QVElPTlMpIEBPcHRpb25hbCgpIHByaXZhdGUgY2xpcGJvYXJkT3B0aW9uczogQ2xpcGJvYXJkT3B0aW9ucyxcclxuICAgIEBJbmplY3QoTUFSS0VEX0VYVEVOU0lPTlMpIEBPcHRpb25hbCgpIHByaXZhdGUgZXh0ZW5zaW9uczogTWFya2VkRXh0ZW5zaW9uW10sXHJcbiAgICBASW5qZWN0KE1BUktFRF9PUFRJT05TKSBAT3B0aW9uYWwoKSBvcHRpb25zOiBNYXJrZWRPcHRpb25zLFxyXG4gICAgQEluamVjdChQTEFURk9STV9JRCkgcHJpdmF0ZSBwbGF0Zm9ybTogT2JqZWN0LFxyXG4gICAgQEluamVjdChTRUNVUklUWV9DT05URVhUKSBwcml2YXRlIHNlY3VyaXR5Q29udGV4dDogU2VjdXJpdHlDb250ZXh0LFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxyXG4gICAgcHJpdmF0ZSBzYW5pdGl6ZXI6IERvbVNhbml0aXplcixcclxuICApIHtcclxuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgfVxyXG5cclxuICBwYXJzZShtYXJrZG93bjogc3RyaW5nLCBwYXJzZU9wdGlvbnM6IFBhcnNlT3B0aW9ucyA9IHRoaXMuREVGQVVMVF9QQVJTRV9PUFRJT05TKTogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIGNvbnN0IHtcclxuICAgICAgZGVjb2RlSHRtbCxcclxuICAgICAgaW5saW5lLFxyXG4gICAgICBlbW9qaSxcclxuICAgICAgbWVybWFpZCxcclxuICAgICAgZGlzYWJsZVNhbml0aXplcixcclxuICAgIH0gPSBwYXJzZU9wdGlvbnM7XHJcblxyXG4gICAgY29uc3QgbWFya2VkT3B0aW9ucyA9IHtcclxuICAgICAgLi4udGhpcy5vcHRpb25zLFxyXG4gICAgICAuLi5wYXJzZU9wdGlvbnMubWFya2VkT3B0aW9ucyxcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcmVuZGVyZXIgPSBtYXJrZWRPcHRpb25zLnJlbmRlcmVyIHx8IHRoaXMucmVuZGVyZXIgfHwgbmV3IFJlbmRlcmVyKCk7XHJcblxyXG4gICAgaWYgKHRoaXMuZXh0ZW5zaW9ucykge1xyXG4gICAgICB0aGlzLnJlbmRlcmVyID0gdGhpcy5leHRlbmRzUmVuZGVyZXJGb3JFeHRlbnNpb25zKHJlbmRlcmVyKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobWVybWFpZCkge1xyXG4gICAgICB0aGlzLnJlbmRlcmVyID0gdGhpcy5leHRlbmRzUmVuZGVyZXJGb3JNZXJtYWlkKHJlbmRlcmVyKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0cmltbWVkID0gdGhpcy50cmltSW5kZW50YXRpb24obWFya2Rvd24pO1xyXG4gICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZUh0bWwgPyB0aGlzLmRlY29kZUh0bWwodHJpbW1lZCkgOiB0cmltbWVkO1xyXG4gICAgY29uc3QgZW1vamlmaWVkID0gZW1vamkgPyB0aGlzLnBhcnNlRW1vamkoZGVjb2RlZCkgOiBkZWNvZGVkO1xyXG4gICAgY29uc3QgbWFya2VkID0gdGhpcy5wYXJzZU1hcmtlZChlbW9qaWZpZWQsIG1hcmtlZE9wdGlvbnMsIGlubGluZSk7XHJcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBkaXNhYmxlU2FuaXRpemVyID8gbWFya2VkIDogdGhpcy5zYW5pdGl6ZXIuc2FuaXRpemUodGhpcy5zZWN1cml0eUNvbnRleHQsIG1hcmtlZCk7XHJcblxyXG4gICAgcmV0dXJuIHNhbml0aXplZCB8fCAnJztcclxuICB9XHJcblxyXG4gIHJlbmRlcihlbGVtZW50OiBIVE1MRWxlbWVudCwgb3B0aW9uczogUmVuZGVyT3B0aW9ucyA9IHRoaXMuREVGQVVMVF9SRU5ERVJfT1BUSU9OUywgdmlld0NvbnRhaW5lclJlZj86IFZpZXdDb250YWluZXJSZWYpOiB2b2lkIHtcclxuICAgIGNvbnN0IHtcclxuICAgICAgY2xpcGJvYXJkLFxyXG4gICAgICBjbGlwYm9hcmRPcHRpb25zLFxyXG4gICAgICBrYXRleCxcclxuICAgICAga2F0ZXhPcHRpb25zLFxyXG4gICAgICBtZXJtYWlkLFxyXG4gICAgICBtZXJtYWlkT3B0aW9ucyxcclxuICAgIH0gPSBvcHRpb25zO1xyXG5cclxuICAgIGlmIChrYXRleCkge1xyXG4gICAgICB0aGlzLnJlbmRlckthdGV4KGVsZW1lbnQsIHtcclxuICAgICAgICAuLi50aGlzLkRFRkFVTFRfS0FURVhfT1BUSU9OUyxcclxuICAgICAgICAuLi5rYXRleE9wdGlvbnMsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKG1lcm1haWQpIHtcclxuICAgICAgdGhpcy5yZW5kZXJNZXJtYWlkKGVsZW1lbnQsIHtcclxuICAgICAgICAuLi50aGlzLkRFRkFVTFRfTUVSTUFJRF9PUFRJT05TLFxyXG4gICAgICAgIC4uLm1lcm1haWRPcHRpb25zLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGlmIChjbGlwYm9hcmQpIHtcclxuICAgICAgdGhpcy5yZW5kZXJDbGlwYm9hcmQoZWxlbWVudCwgdmlld0NvbnRhaW5lclJlZiwge1xyXG4gICAgICAgIC4uLnRoaXMuREVGQVVMVF9DTElQQk9BUkRfT1BUSU9OUyxcclxuICAgICAgICAuLi50aGlzLmNsaXBib2FyZE9wdGlvbnMsXHJcbiAgICAgICAgLi4uY2xpcGJvYXJkT3B0aW9ucyxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5oaWdobGlnaHQoZWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICByZWxvYWQoKTogdm9pZCB7XHJcbiAgICB0aGlzLl9yZWxvYWQkLm5leHQoKTtcclxuICB9XHJcblxyXG4gIGdldFNvdXJjZShzcmM6IHN0cmluZyk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICBpZiAoIXRoaXMuaHR0cCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JTcmNXaXRob3V0SHR0cENsaWVudCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5odHRwXHJcbiAgICAgIC5nZXQoc3JjLCB7IHJlc3BvbnNlVHlwZTogJ3RleHQnIH0pXHJcbiAgICAgIC5waXBlKG1hcChtYXJrZG93biA9PiB0aGlzLmhhbmRsZUV4dGVuc2lvbihzcmMsIG1hcmtkb3duKSkpO1xyXG4gIH1cclxuXHJcbiAgaGlnaGxpZ2h0KGVsZW1lbnQ/OiBFbGVtZW50IHwgRG9jdW1lbnQpOiB2b2lkIHtcclxuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBQcmlzbSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIFByaXNtLmhpZ2hsaWdodEFsbFVuZGVyID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWVsZW1lbnQpIHtcclxuICAgICAgZWxlbWVudCA9IGRvY3VtZW50O1xyXG4gICAgfVxyXG4gICAgY29uc3Qgbm9MYW5ndWFnZUVsZW1lbnRzID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdwcmUgY29kZTpub3QoW2NsYXNzKj1cImxhbmd1YWdlLVwiXSknKTtcclxuICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwobm9MYW5ndWFnZUVsZW1lbnRzLCAoeDogRWxlbWVudCkgPT4geC5jbGFzc0xpc3QuYWRkKCdsYW5ndWFnZS1ub25lJykpO1xyXG4gICAgUHJpc20uaGlnaGxpZ2h0QWxsVW5kZXIoZWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRlY29kZUh0bWwoaHRtbDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcclxuICAgICAgcmV0dXJuIGh0bWw7XHJcbiAgICB9XHJcbiAgICBjb25zdCB0ZXh0YXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7XHJcbiAgICB0ZXh0YXJlYS5pbm5lckhUTUwgPSBodG1sO1xyXG4gICAgcmV0dXJuIHRleHRhcmVhLnZhbHVlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBleHRlbmRzUmVuZGVyZXJGb3JFeHRlbnNpb25zKHJlbmRlcmVyOiBSZW5kZXJlcik6IFJlbmRlcmVyIHtcclxuICAgIGNvbnN0IGV4dGVuZGVkUmVuZGVyZXIgPSByZW5kZXJlciBhcyBFeHRlbmRlZFJlbmRlcmVyO1xyXG4gICAgaWYgKGV4dGVuZGVkUmVuZGVyZXIuybVOZ3hNYXJrZG93blJlbmRlcmVyRXh0ZW5kZWRGb3JFeHRlbnNpb25zID09PSB0cnVlKSB7XHJcbiAgICAgIHJldHVybiByZW5kZXJlcjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5leHRlbnNpb25zPy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIG1hcmtlZC51c2UoLi4udGhpcy5leHRlbnNpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBleHRlbmRlZFJlbmRlcmVyLsm1Tmd4TWFya2Rvd25SZW5kZXJlckV4dGVuZGVkRm9yRXh0ZW5zaW9ucyA9IHRydWU7XHJcblxyXG4gICAgcmV0dXJuIHJlbmRlcmVyO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBleHRlbmRzUmVuZGVyZXJGb3JNZXJtYWlkKHJlbmRlcmVyOiBSZW5kZXJlcik6IFJlbmRlcmVyIHtcclxuICAgIGNvbnN0IGV4dGVuZGVkUmVuZGVyZXIgPSByZW5kZXJlciBhcyBFeHRlbmRlZFJlbmRlcmVyO1xyXG4gICAgaWYgKGV4dGVuZGVkUmVuZGVyZXIuybVOZ3hNYXJrZG93blJlbmRlcmVyRXh0ZW5kZWRGb3JNZXJtYWlkID09PSB0cnVlKSB7XHJcbiAgICAgIHJldHVybiByZW5kZXJlcjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3VuYm91bmQtbWV0aG9kXHJcbiAgICBjb25zdCBkZWZhdWx0Q29kZSA9IHJlbmRlcmVyLmNvZGU7XHJcbiAgICByZW5kZXJlci5jb2RlID0gZnVuY3Rpb24gKGNvZGU6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZyB8IHVuZGVmaW5lZCwgaXNFc2NhcGVkOiBib29sZWFuKSB7XHJcbiAgICAgIHJldHVybiBsYW5ndWFnZSA9PT0gJ21lcm1haWQnXHJcbiAgICAgICAgPyBgPGRpdiBjbGFzcz1cIm1lcm1haWRcIj4ke2NvZGV9PC9kaXY+YFxyXG4gICAgICAgIDogZGVmYXVsdENvZGUuY2FsbCh0aGlzLCBjb2RlLCBsYW5ndWFnZSwgaXNFc2NhcGVkKTtcclxuICAgIH07XHJcblxyXG4gICAgZXh0ZW5kZWRSZW5kZXJlci7JtU5neE1hcmtkb3duUmVuZGVyZXJFeHRlbmRlZEZvck1lcm1haWQgPSB0cnVlO1xyXG5cclxuICAgIHJldHVybiByZW5kZXJlcjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlRXh0ZW5zaW9uKHNyYzogc3RyaW5nLCBtYXJrZG93bjogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHVybFByb3RvY29sSW5kZXggPSBzcmMubGFzdEluZGV4T2YoJzovLycpO1xyXG4gICAgY29uc3QgdXJsV2l0aG91dFByb3RvY29sID0gdXJsUHJvdG9jb2xJbmRleCA+IC0xXHJcbiAgICAgID8gc3JjLnN1YnN0cmluZyh1cmxQcm90b2NvbEluZGV4ICsgNClcclxuICAgICAgOiBzcmM7XHJcblxyXG4gICAgY29uc3QgbGFzdFNsYXNoSW5kZXggPSB1cmxXaXRob3V0UHJvdG9jb2wubGFzdEluZGV4T2YoJy8nKTtcclxuICAgIGNvbnN0IGxhc3RVcmxTZWdtZW50ID0gbGFzdFNsYXNoSW5kZXggPiAtMVxyXG4gICAgICA/IHVybFdpdGhvdXRQcm90b2NvbC5zdWJzdHJpbmcobGFzdFNsYXNoSW5kZXggKyAxKS5zcGxpdCgnPycpWzBdXHJcbiAgICAgIDogJyc7XHJcblxyXG4gICAgY29uc3QgbGFzdERvdEluZGV4ID0gbGFzdFVybFNlZ21lbnQubGFzdEluZGV4T2YoJy4nKTtcclxuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGxhc3REb3RJbmRleCA+IC0xXHJcbiAgICAgID8gbGFzdFVybFNlZ21lbnQuc3Vic3RyaW5nKGxhc3REb3RJbmRleCArIDEpXHJcbiAgICAgIDogJyc7XHJcblxyXG4gICAgcmV0dXJuICEhZXh0ZW5zaW9uICYmIGV4dGVuc2lvbiAhPT0gJ21kJ1xyXG4gICAgICA/ICdgYGAnICsgZXh0ZW5zaW9uICsgJ1xcbicgKyBtYXJrZG93biArICdcXG5gYGAnXHJcbiAgICAgIDogbWFya2Rvd247XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBhcnNlTWFya2VkKGh0bWw6IHN0cmluZywgbWFya2VkT3B0aW9uczogTWFya2VkT3B0aW9ucywgaW5saW5lID0gZmFsc2UpOiBzdHJpbmcgfCBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgaWYgKG1hcmtlZE9wdGlvbnMucmVuZGVyZXIpIHtcclxuICAgICAgLy8gY2xvbmUgcmVuZGVyZXIgYW5kIHJlbW92ZSBleHRlbmRlZCBmbGFncyBvdGhlcndpc2VcclxuICAgICAgLy8gbWFya2VkIHRocm93cyBhbiBlcnJvciB0aGlua2luZyBpdCBpcyBhIHJlbmRlcmVyIHByb3BcclxuICAgICAgY29uc3QgcmVuZGVyZXIgPSB7IC4uLm1hcmtlZE9wdGlvbnMucmVuZGVyZXIgfSBhcyBQYXJ0aWFsPEV4dGVuZGVkUmVuZGVyZXI+O1xyXG4gICAgICBkZWxldGUgcmVuZGVyZXIuybVOZ3hNYXJrZG93blJlbmRlcmVyRXh0ZW5kZWRGb3JFeHRlbnNpb25zO1xyXG4gICAgICBkZWxldGUgcmVuZGVyZXIuybVOZ3hNYXJrZG93blJlbmRlcmVyRXh0ZW5kZWRGb3JNZXJtYWlkO1xyXG5cclxuICAgICAgLy8gcmVtb3ZlIHJlbmRlcmVyIGZyb20gbWFya2VkT3B0aW9ucyBiZWNhdXNlIGlmIHJlbmRlcmVyIGlzXHJcbiAgICAgIC8vIHBhc3NlZCB0byBtYXJrZWQucGFyc2UgbWV0aG9kLCBpdCB3aWxsIGlnbm9yZSBhbGwgZXh0ZW5zaW9uc1xyXG4gICAgICBkZWxldGUgbWFya2VkT3B0aW9ucy5yZW5kZXJlcjtcclxuXHJcbiAgICAgIG1hcmtlZC51c2UoeyByZW5kZXJlciB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaW5saW5lXHJcbiAgICAgID8gbWFya2VkLnBhcnNlSW5saW5lKGh0bWwsIG1hcmtlZE9wdGlvbnMpXHJcbiAgICAgIDogbWFya2VkLnBhcnNlKGh0bWwsIG1hcmtlZE9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXJzZUVtb2ppKGh0bWw6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBpZiAoIWlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XHJcbiAgICAgIHJldHVybiBodG1sO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBqb3lwaXhlbHMgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBqb3lwaXhlbHMuc2hvcnRuYW1lVG9Vbmljb2RlID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JKb3lQaXhlbHNOb3RMb2FkZWQpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGpveXBpeGVscy5zaG9ydG5hbWVUb1VuaWNvZGUoaHRtbCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbmRlckthdGV4KGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBvcHRpb25zOiBLYXRleE9wdGlvbnMpOiB2b2lkIHtcclxuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBrYXRleCA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHJlbmRlck1hdGhJbkVsZW1lbnQgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvckthdGV4Tm90TG9hZGVkKTtcclxuICAgIH1cclxuICAgIHJlbmRlck1hdGhJbkVsZW1lbnQoZWxlbWVudCwgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbmRlckNsaXBib2FyZChlbGVtZW50OiBIVE1MRWxlbWVudCwgdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZiB8IHVuZGVmaW5lZCwgb3B0aW9uczogQ2xpcGJvYXJkUmVuZGVyT3B0aW9ucyk6IHZvaWQge1xyXG4gICAgaWYgKCFpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIENsaXBib2FyZEpTID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JDbGlwYm9hcmROb3RMb2FkZWQpO1xyXG4gICAgfVxyXG4gICAgaWYgKCF2aWV3Q29udGFpbmVyUmVmKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvckNsaXBib2FyZFZpZXdDb250YWluZXJSZXF1aXJlZCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qge1xyXG4gICAgICBidXR0b25Db21wb25lbnQsXHJcbiAgICAgIGJ1dHRvblRlbXBsYXRlLFxyXG4gICAgfSA9IG9wdGlvbnM7XHJcblxyXG4gICAgLy8gdGFyZ2V0IGV2ZXJ5IDxwcmU+IGVsZW1lbnRzXHJcbiAgICBjb25zdCBwcmVFbGVtZW50cyA9IGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgncHJlJyk7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHByZUVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHByZUVsZW1lbnQgPSBwcmVFbGVtZW50cy5pdGVtKGkpO1xyXG5cclxuICAgICAgLy8gY3JlYXRlIDxwcmU+IHdyYXBwZXIgZWxlbWVudFxyXG4gICAgICBjb25zdCBwcmVXcmFwcGVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICBwcmVXcmFwcGVyRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7XHJcbiAgICAgIHByZUVsZW1lbnQucGFyZW50Tm9kZSEuaW5zZXJ0QmVmb3JlKHByZVdyYXBwZXJFbGVtZW50LCBwcmVFbGVtZW50KTtcclxuICAgICAgcHJlV3JhcHBlckVsZW1lbnQuYXBwZW5kQ2hpbGQocHJlRWxlbWVudCk7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgdG9vbGJhciBlbGVtZW50XHJcbiAgICAgIGNvbnN0IHRvb2xiYXJXcmFwcGVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICB0b29sYmFyV3JhcHBlckVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgICB0b29sYmFyV3JhcHBlckVsZW1lbnQuc3R5bGUudG9wID0gJy41ZW0nO1xyXG4gICAgICB0b29sYmFyV3JhcHBlckVsZW1lbnQuc3R5bGUucmlnaHQgPSAnLjVlbSc7XHJcbiAgICAgIHRvb2xiYXJXcmFwcGVyRWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gJzAnO1xyXG4gICAgICB0b29sYmFyV3JhcHBlckVsZW1lbnQuc3R5bGUudHJhbnNpdGlvbiA9ICdvcGFjaXR5IDI1MG1zIGVhc2Utb3V0JztcclxuICAgICAgdG9vbGJhcldyYXBwZXJFbGVtZW50LnN0eWxlLnpJbmRleCA9ICcxJztcclxuICAgICAgcHJlV3JhcHBlckVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdiZWZvcmVlbmQnLCB0b29sYmFyV3JhcHBlckVsZW1lbnQpO1xyXG5cclxuICAgICAgLy8gcmVnaXN0ZXIgbGlzdGVuZXIgdG8gc2hvdy9oaWRlIHRvb2xiYXJcclxuICAgICAgcHJlRWxlbWVudC5vbm1vdXNlb3ZlciA9ICgpID0+IHRvb2xiYXJXcmFwcGVyRWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gJzEnO1xyXG4gICAgICBwcmVFbGVtZW50Lm9ubW91c2VvdXQgPSAoKSA9PiB0b29sYmFyV3JhcHBlckVsZW1lbnQuc3R5bGUub3BhY2l0eSA9ICcwJztcclxuXHJcbiAgICAgIC8vIGRlY2xhcmUgZW1iZWRkZWRWaWV3UmVmIGhvbGRpbmcgdmFyaWFibGVcclxuICAgICAgbGV0IGVtYmVkZGVkVmlld1JlZjogRW1iZWRkZWRWaWV3UmVmPHVua25vd24+O1xyXG5cclxuICAgICAgLy8gdXNlIHByb3ZpZGVkIGNvbXBvbmVudCB2aWEgaW5wdXQgcHJvcGVydHlcclxuICAgICAgLy8gb3IgcHJvdmlkZWQgdmlhIENsaXBib2FyZE9wdGlvbnMgcHJvdmlkZXJcclxuICAgICAgaWYgKGJ1dHRvbkNvbXBvbmVudCkge1xyXG4gICAgICAgIGNvbnN0IGNvbXBvbmVudFJlZiA9IHZpZXdDb250YWluZXJSZWYuY3JlYXRlQ29tcG9uZW50KGJ1dHRvbkNvbXBvbmVudCk7XHJcbiAgICAgICAgZW1iZWRkZWRWaWV3UmVmID0gY29tcG9uZW50UmVmLmhvc3RWaWV3IGFzIEVtYmVkZGVkVmlld1JlZjx1bmtub3duPjtcclxuICAgICAgICBjb21wb25lbnRSZWYuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgIH1cclxuICAgICAgLy8gdXNlIHByb3ZpZGVkIHRlbXBsYXRlIHZpYSBpbnB1dCBwcm9wZXJ0eVxyXG4gICAgICBlbHNlIGlmIChidXR0b25UZW1wbGF0ZSkge1xyXG4gICAgICAgIGVtYmVkZGVkVmlld1JlZiA9IHZpZXdDb250YWluZXJSZWYuY3JlYXRlRW1iZWRkZWRWaWV3KGJ1dHRvblRlbXBsYXRlKTtcclxuICAgICAgfVxyXG4gICAgICAvLyB1c2UgZGVmYXVsdCBjb21wb25lbnRcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY29uc3QgY29tcG9uZW50UmVmID0gdmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQoQ2xpcGJvYXJkQnV0dG9uQ29tcG9uZW50KTtcclxuICAgICAgICBlbWJlZGRlZFZpZXdSZWYgPSBjb21wb25lbnRSZWYuaG9zdFZpZXcgYXMgRW1iZWRkZWRWaWV3UmVmPHVua25vd24+O1xyXG4gICAgICAgIGNvbXBvbmVudFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gZGVjbGFyZSBjbGlwYm9hcmQgaW5zdGFuY2UgdmFyaWFibGVcclxuICAgICAgbGV0IGNsaXBib2FyZEluc3RhbmNlOiB0eXBlb2YgQ2xpcGJvYXJkSlM7XHJcblxyXG4gICAgICAvLyBhdHRhY2ggY2xpcGJvYXJkLmpzIHRvIHJvb3Qgbm9kZVxyXG4gICAgICBlbWJlZGRlZFZpZXdSZWYucm9vdE5vZGVzLmZvckVhY2goKG5vZGU6IEhUTUxFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgbm9kZS5vbm1vdXNlb3ZlciA9ICgpID0+IHRvb2xiYXJXcmFwcGVyRWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gJzEnO1xyXG4gICAgICAgIHRvb2xiYXJXcmFwcGVyRWxlbWVudC5hcHBlbmRDaGlsZChub2RlKTtcclxuICAgICAgICBjbGlwYm9hcmRJbnN0YW5jZSA9IG5ldyBDbGlwYm9hcmRKUyhub2RlLCB7IHRleHQ6ICgpID0+IHByZUVsZW1lbnQuaW5uZXJUZXh0IH0pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIGRlc3Ryb3kgY2xpcGJvYXJkIGluc3RhbmNlIHdoZW4gdmlldyBpcyBkZXN0cm95ZWRcclxuICAgICAgZW1iZWRkZWRWaWV3UmVmLm9uRGVzdHJveSgoKSA9PiBjbGlwYm9hcmRJbnN0YW5jZS5kZXN0cm95KCkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW5kZXJNZXJtYWlkKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBvcHRpb25zOiBNZXJtYWlkQVBJLkNvbmZpZyA9IHRoaXMuREVGQVVMVF9NRVJNQUlEX09QVElPTlMpOiB2b2lkIHtcclxuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBtZXJtYWlkID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgbWVybWFpZC5pbml0aWFsaXplID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNZXJtYWlkTm90TG9hZGVkKTtcclxuICAgIH1cclxuICAgIGNvbnN0IG1lcm1haWRFbGVtZW50cyA9IGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbDxIVE1MRWxlbWVudD4oJy5tZXJtYWlkJyk7XHJcbiAgICBpZiAobWVybWFpZEVsZW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBtZXJtYWlkLmluaXRpYWxpemUob3B0aW9ucyk7XHJcbiAgICBtZXJtYWlkLnJ1bih7IG5vZGVzOiBtZXJtYWlkRWxlbWVudHMgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHRyaW1JbmRlbnRhdGlvbihtYXJrZG93bjogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGlmICghbWFya2Rvd24pIHtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gICAgbGV0IGluZGVudFN0YXJ0OiBudW1iZXI7XHJcbiAgICByZXR1cm4gbWFya2Rvd25cclxuICAgICAgLnNwbGl0KCdcXG4nKVxyXG4gICAgICAubWFwKGxpbmUgPT4ge1xyXG4gICAgICAgIGxldCBsaW5lSWRlbnRTdGFydCA9IGluZGVudFN0YXJ0O1xyXG4gICAgICAgIGlmIChsaW5lLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGxpbmVJZGVudFN0YXJ0ID0gaXNOYU4obGluZUlkZW50U3RhcnQpXHJcbiAgICAgICAgICAgID8gbGluZS5zZWFyY2goL1xcU3wkLylcclxuICAgICAgICAgICAgOiBNYXRoLm1pbihsaW5lLnNlYXJjaCgvXFxTfCQvKSwgbGluZUlkZW50U3RhcnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXNOYU4oaW5kZW50U3RhcnQpKSB7XHJcbiAgICAgICAgICBpbmRlbnRTdGFydCA9IGxpbmVJZGVudFN0YXJ0O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbGluZUlkZW50U3RhcnRcclxuICAgICAgICAgID8gbGluZS5zdWJzdHJpbmcobGluZUlkZW50U3RhcnQpXHJcbiAgICAgICAgICA6IGxpbmU7XHJcbiAgICAgIH0pLmpvaW4oJ1xcbicpO1xyXG4gIH1cclxufVxyXG4iXX0=